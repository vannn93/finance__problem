<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MoneyMirror Analysis - GenZ Finance Hub</title>
    <link rel="stylesheet" href="../css/main.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <script type="module" async
        src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fgenzfinan7345back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.10"></script>
    <script type="module" defer src="https://static.rocket.new/rocket-shot.js?v=0.0.1"></script>
    <style>
        /* Share Modal Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        .bounce-in {
            animation: bounceIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes bounceIn {
            0% {
                transform: scale(0.3);
                opacity: 0;
            }

            50% {
                transform: scale(1.05);
                opacity: 0.8;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        /* Micro celebration effect */
        .micro-celebrate {
            transition: all 0.2s ease;
        }

        .micro-celebrate:active {
            transform: scale(0.95);
        }

        /* ========================================= */
        /* MOBILE OPTIMIZATION (‚â§ 768px) - FIX SEMUA */
        /* ========================================= */

        @media only screen and (max-width: 768px) {

            /* 1. RESET LAYOUT UTAMA */
            body {
                overflow-x: hidden !important;
                width: 100% !important;
            }

            main {
                padding: 1rem !important;
                max-width: 100% !important;
                margin: 0 !important;
            }

            .max-w-7xl {
                max-width: 100% !important;
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }

            /* 2. HEADER & TITLE */
            .mb-8.fade-in {
                margin-bottom: 1.5rem !important;
            }

            .mb-8.fade-in .flex {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 1rem !important;
            }

            h1.text-3xl {
                font-size: 1.5rem !important;
                line-height: 2rem !important;
                margin-bottom: 0.5rem !important;
            }

            .text-text-secondary {
                font-size: 0.875rem !important;
            }

            /* Sembunyikan total expense di mobile header */
            .hidden.sm\:flex {
                display: none !important;
            }

            /* 3. STATS CARDS - 2 KOLOM */
            .grid.grid-cols-1.md\:grid-cols-4 {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 0.75rem !important;
                margin-bottom: 1.5rem !important;
            }

            .morphic-card.p-6 {
                padding: 1rem !important;
                margin: 0 !important;
            }

            .morphic-card .flex.items-center {
                align-items: flex-start !important;
                flex-direction: row !important;
            }

            .morphic-card .p-3 {
                padding: 0.75rem !important;
                min-width: 48px !important;
                height: 48px !important;
            }

            .morphic-card .ml-4 {
                margin-left: 0.75rem !important;
            }

            .morphic-card .text-xl {
                font-size: 1.125rem !important;
            }

            .morphic-card .text-sm {
                font-size: 0.75rem !important;
            }

            /* 4. MOOD & EXPENSE SECTION - STACK */
            .grid.grid-cols-1.lg\:grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
                margin-bottom: 1.5rem !important;
            }

            /* 5. MOOD BUTTONS - 3 KOLOM */
            .grid.grid-cols-5 {
                grid-template-columns: repeat(3, 1fr) !important;
                gap: 0.5rem !important;
                margin-bottom: 1rem !important;
            }

            .mood-btn {
                padding: 0.75rem 0.5rem !important;
                min-height: auto !important;
            }

            .mood-btn .text-3xl {
                font-size: 1.5rem !important;
                margin-bottom: 0.25rem !important;
            }

            .mood-btn .text-xs {
                font-size: 0.625rem !important;
                line-height: 1.2 !important;
            }

            /* 6. FORM INPUT MOBILE */
            .input-field {
                padding: 0.75rem !important;
                font-size: 16px !important;
                width: 100% !important;
            }

            textarea.input-field.h-20 {
                height: 80px !important;
                min-height: 80px !important;
            }

            .relative .absolute.left-3 {
                left: 0.75rem !important;
            }

            .pl-10 {
                padding-left: 2.5rem !important;
            }

            /* 7. CHART SECTION */
            .morphic-card.p-6.mb-8 {
                margin-bottom: 1.5rem !important;
            }

            .morphic-card.p-6.mb-8 .flex.items-center.justify-between.mb-6 {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 1rem !important;
                margin-bottom: 1rem !important;
            }

            .flex.items-center.space-x-4 {
                width: 100% !important;
                justify-content: space-between !important;
            }

            .h-80 {
                height: 250px !important;
            }

            /* 8. HISTORICAL DATA SECTION */
            .grid.grid-cols-1.lg\:grid-cols-3 {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }

            .lg\:col-span-2 {
                grid-column: 1 !important;
            }

            .morphic-card.p-6 .flex.items-center.justify-between.mb-6 {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 1rem !important;
                margin-bottom: 1rem !important;
            }

            .flex.items-center.space-x-2 {
                width: 100% !important;
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }

            /* 9. TABLE MOBILE FIX */
            .hidden.md\:block {
                display: none !important;
            }

            .md\:hidden {
                display: block !important;
            }

            /* Mobile cards styling */
            .morphic-card.p-4 {
                padding: 1rem !important;
                margin-bottom: 0.75rem !important;
            }

            .morphic-card.p-4 .flex.justify-between.items-start.mb-2 {
                margin-bottom: 0.75rem !important;
            }

            /* 10. INSIGHTS & PROGRESS CARDS */
            .space-y-6 {
                gap: 1rem !important;
            }

            .space-y-4>*+* {
                margin-top: 1rem !important;
            }

            /* 11. BUTTONS MOBILE */
            .btn-primary,
            .btn-secondary {
                padding: 0.875rem 1rem !important;
                font-size: 0.875rem !important;
                width: 100% !important;
                min-height: 44px !important;
            }

            /* ========================================= */
            /* NAVBAR MOBILE FIX */
            /* ========================================= */

            @media only screen and (max-width: 768px) {

                /* 1. FIX NAVBAR CONTAINER */
                nav .max-w-7xl.mx-auto.px-4.sm\:px-6.lg\:px-8 {
                    padding-left: 1rem !important;
                    padding-right: 1rem !important;
                    width: 100% !important;
                }

                /* 2. FIX NAVBAR HEIGHT DAN LAYOUT */
                nav .flex.justify-between.items-center.h-16 {
                    height: 60px !important;
                    padding: 0.5rem 0 !important;
                }

                /* 3. LOGO SIZE MOBILE */
                .text-xl.font-bold.text-gradient {
                    font-size: 1.125rem !important;
                }

                .inline-flex.items-center.justify-center.w-10.h-10 {
                    width: 36px !important;
                    height: 36px !important;
                }

                /* 4. HAMBURGER BUTTON FIX */
                .md\:hidden button {
                    padding: 0.5rem !important;
                    margin-left: 0.5rem !important;
                }

                .md\:hidden button i {
                    font-size: 1.25rem !important;
                }

                /* 5. MOBILE MENU FIX (YANG INI YANG PALING PENTING) */
                #mobileMenu {
                    position: fixed !important;
                    top: 60px !important;
                    left: 0 !important;
                    right: 0 !important;
                    bottom: 0 !important;
                    background: rgba(255, 255, 255, 0.98) !important;
                    backdrop-filter: blur(20px) !important;
                    -webkit-backdrop-filter: blur(20px) !important;
                    z-index: 9999 !important;
                    padding: 1.5rem 1rem !important;
                    overflow-y: auto !important;
                    transform: translateX(-100%) !important;
                    transition: transform 0.3s ease-in-out !important;
                    border-top: 1px solid rgba(0, 0, 0, 0.1) !important;
                }

                /* Menu aktif state */
                #mobileMenu:not(.hidden) {
                    transform: translateX(0) !important;
                    display: block !important;
                    visibility: visible !important;
                }

                /* Menu hidden state */
                #mobileMenu.hidden {
                    display: none !important;
                    visibility: hidden !important;
                }

                /* 6. MOBILE MENU ITEMS STYLING */
                #mobileMenu .px-2.pt-2.pb-3.space-y-1 {
                    padding: 0 !important;
                }

                #mobileMenu a {
                    display: flex !important;
                    align-items: center !important;
                    padding: 1rem 1.25rem !important;
                    margin: 0.25rem 0 !important;
                    border-radius: 0.75rem !important;
                    background: rgba(255, 255, 255, 0.9) !important;
                    border: 1px solid rgba(0, 0, 0, 0.08) !important;
                    font-size: 1rem !important;
                    font-weight: 500 !important;
                    transition: all 0.2s ease !important;
                }

                #mobileMenu a:hover {
                    background: rgba(99, 102, 241, 0.1) !important;
                    transform: translateX(4px) !important;
                }

                #mobileMenu a.bg-primary-100 {
                    background: rgba(99, 102, 241, 0.15) !important;
                    border-color: rgba(99, 102, 241, 0.3) !important;
                    color: #4f46e5 !important;
                }

                #mobileMenu a i {
                    width: 24px !important;
                    margin-right: 0.75rem !important;
                    font-size: 1.125rem !important;
                }

                /* 7. PREVENT BODY SCROLL WHEN MENU IS OPEN */
                body.menu-open {
                    overflow: hidden !important;
                    position: fixed !important;
                    width: 100% !important;
                    height: 100% !important;
                }

                /* 8. OVERLAY BACKGROUND WHEN MENU IS OPEN */
                .menu-overlay {
                    position: fixed !important;
                    top: 60px !important;
                    left: 0 !important;
                    right: 0 !important;
                    bottom: 0 !important;
                    background: rgba(0, 0, 0, 0.5) !important;
                    z-index: 9998 !important;
                    opacity: 0;
                    visibility: hidden;
                    transition: all 0.3s ease !important;
                }

                .menu-overlay.active {
                    opacity: 1 !important;
                    visibility: visible !important;
                }

                /* 9. CLOSE BUTTON FOR MOBILE MENU */
                .menu-close-btn {
                    position: absolute !important;
                    top: 1rem !important;
                    right: 1rem !important;
                    width: 40px !important;
                    height: 40px !important;
                    border-radius: 50% !important;
                    background: rgba(0, 0, 0, 0.05) !important;
                    display: flex !important;
                    align-items: center !important;
                    justify-content: center !important;
                    border: none !important;
                    font-size: 1.25rem !important;
                    color: #666 !important;
                    z-index: 10000 !important;
                }

                /* 10. MENU HEADER */
                .menu-header {
                    padding: 1rem 1.25rem !important;
                    border-bottom: 1px solid rgba(0, 0, 0, 0.1) !important;
                    margin-bottom: 1rem !important;
                }

                .menu-title {
                    font-size: 1.25rem !important;
                    font-weight: 700 !important;
                    color: #1f2937 !important;
                }

                /* ========================================= */
                /* VERY SMALL MOBILE (‚â§ 480px) */
                /* ========================================= */

                @media only screen and (max-width: 480px) {

                    /* Navbar lebih kompak */
                    nav .flex.justify-between.items-center.h-16 {
                        height: 56px !important;
                    }

                    #mobileMenu {
                        top: 56px !important;
                    }

                    .menu-overlay {
                        top: 56px !important;
                    }

                    /* Logo lebih kecil */
                    .text-xl.font-bold.text-gradient {
                        font-size: 1rem !important;
                    }

                    .inline-flex.items-center.justify-center.w-10.h-10 {
                        width: 32px !important;
                        height: 32px !important;
                    }

                    .mr-3 {
                        margin-right: 0.5rem !important;
                    }
                }

                /* Mobile menu fix */
                #mobileMenu.md\:hidden.hidden {
                    position: fixed !important;
                    top: 3.5rem !important;
                    left: 0 !important;
                    right: 0 !important;
                    background: white !important;
                    z-index: 1000 !important;
                    padding: 1rem !important;
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
                }

                /* 13. PAGINATION MOBILE */
                .flex.items-center.justify-between.mt-6 {
                    flex-direction: column !important;
                    gap: 1rem !important;
                    align-items: center !important;
                }

                /* 14. BACKGROUND PATTERN SCALE DOWN */
                .absolute.inset-0.opacity-10 .absolute {
                    transform: scale(0.5) !important;
                }
            }

            /* ========================================= */
            /* VERY SMALL MOBILE (‚â§ 480px) */
            /* ========================================= */

            @media only screen and (max-width: 480px) {

                /* Stats cards jadi 1 kolom */
                .grid.grid-cols-1.md\:grid-cols-4 {
                    grid-template-columns: 1fr !important;
                }

                /* Mood buttons jadi 2 kolom */
                .grid.grid-cols-5 {
                    grid-template-columns: repeat(2, 1fr) !important;
                }

                /* Font lebih kecil */
                h1.text-3xl {
                    font-size: 1.25rem !important;
                }

                .text-xl {
                    font-size: 1rem !important;
                }

                /* Card padding lebih kecil */
                .morphic-card.p-6 {
                    padding: 0.875rem !important;
                }

                /* Chart lebih kecil */
                .h-80 {
                    height: 200px !important;
                }

                /* Form elements lebih kompak */
                .input-field {
                    padding: 0.625rem !important;
                }
            }

            /* ========================================= */
            /* TOUCH OPTIMIZATION */
            /* ========================================= */

            @media (max-width: 768px) {

                /* Touch friendly elements */
                button,
                .btn,
                .mood-btn,
                select,
                [role="button"] {
                    min-height: 44px !important;
                    min-width: 44px !important;
                    -webkit-tap-highlight-color: transparent !important;
                }

                /* Touch feedback */
                button:active,
                .btn:active,
                .mood-btn:active {
                    opacity: 0.7 !important;
                    transform: scale(0.98) !important;
                }
            }
        }

        /* ========================================= */
        /* iOS SPECIFIC FIXES */
        /* ========================================= */

        @supports (-webkit-touch-callout: none) {
            @media (max-width: 768px) {

                /* Prevent zoom on input focus */
                input[type="text"],
                input[type="number"],
                input[type="email"],
                input[type="tel"],
                input[type="url"],
                input[type="search"],
                textarea {
                    font-size: 16px !important;
                }

                /* Fix 100vh issue */
                .min-h-screen {
                    min-height: -webkit-fill-available !important;
                }
            }
        }

        /* ========================================= */
        /* MOBILE PERFORMANCE */
        /* ========================================= */

        @media (max-width: 768px) {

            /* Reduce animations */
            * {
                animation-duration: 0.2s !important;
            }

            /* Smooth scrolling */
            html {
                scroll-behavior: smooth;
                -webkit-overflow-scrolling: touch;
            }

            /* Optimize images */
            img {
                max-width: 100%;
                height: auto;
            }
        }

        /* ========================================= */
        /* FORM RESPONSIF MOBILE FIX */
        /* ========================================= */

        @media only screen and (max-width: 768px) {

            /* 1. FORM CONTAINER FIX */
            .morphic-card.p-6.fade-in {
                padding: 1.25rem !important;
                margin: 0.5rem 0 !important;
            }

            /* 2. FORM TITLE */
            .morphic-card.p-6.fade-in h2.text-xl {
                font-size: 1.125rem !important;
                margin-bottom: 1.25rem !important;
                padding-bottom: 0.75rem !important;
                border-bottom: 2px solid #f3f4f6 !important;
            }

            /* 3. FORM GROUP SPACING */
            #expenseForm.space-y-4>* {
                margin-bottom: 1rem !important;
            }

            /* 4. LABEL STYLING */
            .block.text-sm.font-medium.text-gray-700.mb-2 {
                font-size: 0.875rem !important;
                margin-bottom: 0.5rem !important;
                display: block !important;
                width: 100% !important;
            }

            /* 5. INPUT FIELD FIX (TERMASUK YANG ADA Rp) */
            .input-field {
                width: 100% !important;
                padding: 0.875rem !important;
                font-size: 16px !important;
                border: 2px solid #e5e7eb !important;
                border-radius: 0.75rem !important;
                background: #ffffff !important;
                transition: all 0.2s ease !important;
            }

            .input-field:focus {
                border-color: #6366f1 !important;
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1) !important;
                outline: none !important;
            }

            /* 6. FIX UNTUK INPUT DENGAN Rp (CURRENCY) */
            .relative .absolute.left-3 {
                left: 0.875rem !important;
                top: 50% !important;
                transform: translateY(-50%) !important;
                font-size: 1rem !important;
                font-weight: 500 !important;
                color: #4b5563 !important;
                z-index: 10 !important;
            }

            .pl-10 {
                padding-left: 3rem !important;
            }

            /* 7. SELECT DROPDOWN FIX */
            select.input-field {
                appearance: none !important;
                -webkit-appearance: none !important;
                background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e") !important;
                background-repeat: no-repeat !important;
                background-position: right 0.875rem center !important;
                background-size: 1.25em !important;
                padding-right: 2.5rem !important;
            }

            /* 8. DATETIME INPUT FIX */
            input[type="datetime-local"].input-field {
                min-height: 48px !important;
            }

            /* 9. TEXTAREA FIX */
            textarea.input-field {
                min-height: 100px !important;
                resize: vertical !important;
                line-height: 1.5 !important;
            }

            /* 10. BUTTON FORM FIX */
            #expenseForm button[type="submit"] {
                width: 100% !important;
                padding: 1rem !important;
                font-size: 1rem !important;
                font-weight: 600 !important;
                border-radius: 0.75rem !important;
                margin-top: 0.5rem !important;
            }

            /* 11. FORM GRID LAYOUT FIX */
            .grid.grid-cols-1.lg\:grid-cols-2 {
                grid-template-columns: 1fr !important;
                gap: 1.25rem !important;
            }

            /* 12. FIX UNTUK SPACE ANTAR ELEMEN FORM */
            #expenseForm .space-y-4>*+* {
                margin-top: 1.25rem !important;
            }

            /* 13. FIX ICON DI FORM TITLE */
            .morphic-card.p-6.fade-in h2 i {
                font-size: 1.125rem !important;
                margin-right: 0.5rem !important;
            }

            /* 14. FIX UNTUK MOBILE KEYBOARD */
            @supports (-webkit-touch-callout: none) {
                .input-field {
                    font-size: 16px !important;
                }

                input[type="datetime-local"] {
                    min-height: 44px !important;
                }
            }

            /* 15. PLACEHOLDER STYLING */
            .input-field::placeholder {
                color: #9ca3af !important;
                font-size: 0.875rem !important;
            }

            /* 16. ERROR STATE */
            .input-field:invalid:not(:focus) {
                border-color: #ef4444 !important;
            }

            /* 17. SUCCESS STATE */
            .input-field:valid:not(:focus) {
                border-color: #10b981 !important;
            }

            /* 18. DISABLED STATE */
            .input-field:disabled {
                background-color: #f9fafb !important;
                cursor: not-allowed !important;
                opacity: 0.7 !important;
            }
        }

        /* ========================================= */
        /* VERY SMALL MOBILE (‚â§ 480px) */
        /* ========================================= */

        @media only screen and (max-width: 480px) {

            /* Form lebih kompak untuk layar kecil */
            .morphic-card.p-6.fade-in {
                padding: 1rem !important;
            }

            .input-field {
                padding: 0.75rem !important;
                font-size: 15px !important;
            }

            .relative .absolute.left-3 {
                left: 0.75rem !important;
                font-size: 0.875rem !important;
            }

            .pl-10 {
                padding-left: 2.75rem !important;
            }

            textarea.input-field {
                min-height: 90px !important;
            }

            #expenseForm button[type="submit"] {
                padding: 0.875rem !important;
                font-size: 0.9375rem !important;
            }
        }

        /* ========================================= */
        /* LANDSCAPE MODE FIX */
        /* ========================================= */

        @media only screen and (max-width: 768px) and (orientation: landscape) {

            /* Optimalkan form untuk landscape */
            .morphic-card.p-6.fade-in {
                padding: 1rem !important;
            }

            .input-field {
                padding: 0.625rem 0.875rem !important;
                font-size: 14px !important;
            }

            textarea.input-field {
                min-height: 60px !important;
            }

            /* Grid 2 kolom untuk landscape */
            .grid.grid-cols-1.lg\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 1rem !important;
            }
        }

        /* ========================================= */
        /* TABLET (768px - 1024px) */
        /* ========================================= */

        @media only screen and (min-width: 769px) and (max-width: 1024px) {

            /* Tablet optimization */
            .morphic-card.p-6.fade-in {
                padding: 1.5rem !important;
            }

            .input-field {
                padding: 0.875rem !important;
            }

            /* Grid tetap 2 kolom untuk tablet */
            .grid.grid-cols-1.lg\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* ========================================= */
        /* ANIMASI DAN TRANSISI */
        /* ========================================= */

        @media only screen and (max-width: 768px) {
            .input-field {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
            }

            /* Animasi focus ring */
            .input-field:focus {
                animation: focusPulse 0.3s ease-in-out !important;
            }

            @keyframes focusPulse {
                0% {
                    box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4);
                }

                70% {
                    box-shadow: 0 0 0 6px rgba(99, 102, 241, 0);
                }

                100% {
                    box-shadow: 0 0 0 0 rgba(99, 102, 241, 0);
                }
            }

            /* Animasi button hover */
            #expenseForm button[type="submit"] {
                transition: all 0.2s ease !important;
            }

            #expenseForm button[type="submit"]:active {
                transform: scale(0.98) !important;
            }
        }

        /* ========================================= */
        /* DARK MODE SUPPORT */
        /* ========================================= */

        @media (prefers-color-scheme: dark) and (max-width: 768px) {
            .input-field {
                background-color: #ffffff !important;
                border-color: #2e2b2b !important;
                color: #1e1e1f !important;
            }

            .input-field::placeholder {
                color: #1c1c1d !important;
            }

            .block.text-sm.font-medium.text-gray-700.mb-2 {
                color: #212223 !important;
            }

            .relative .absolute.left-3 {
                color: #313232 !important;
            }
        }

        /* ========================================= */
        /* HIGH CONTRAST MODE */
        /* ========================================= */

        @media (prefers-contrast: high) and (max-width: 768px) {
            .input-field {
                border-width: 3px !important;
            }

            .input-field:focus {
                border-color: #0000ff !important;
                box-shadow: 0 0 0 4px rgba(0, 0, 255, 0.5) !important;
            }
        }

        /* ========================================= */
        /* REDUCED MOTION */
        /* ========================================= */

        @media (prefers-reduced-motion: reduce) and (max-width: 768px) {

            .input-field,
            #expenseForm button[type="submit"] {
                transition: none !important;
            }

            .input-field:focus {
                animation: none !important;
            }
        }

    </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-primary-50 via-secondary-50 to-accent-50">
    <!-- Background Pattern -->
    <div class="absolute inset-0 opacity-10">
        <div class="absolute top-10 left-10 w-32 h-32 bg-primary-300 rounded-full blur-xl"></div>
        <div class="absolute top-40 right-20 w-24 h-24 bg-secondary-300 rounded-full blur-lg"></div>
        <div class="absolute bottom-20 left-1/4 w-40 h-40 bg-accent-300 rounded-full blur-2xl"></div>
        <div class="absolute bottom-40 right-10 w-28 h-28 bg-primary-400 rounded-full blur-lg"></div>
    </div>

    <!-- Navigation Header -->
    <nav class="relative z-50 bg-white/80 backdrop-blur-md border-b border-gray-200/50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <div class="flex items-center">
                        <div
                            class="inline-flex items-center justify-center w-10 h-10 bg-gradient-to-r from-primary-500 to-secondary-500 rounded-xl mr-3">
                            <i class="fas fa-wallet text-white text-lg"></i>
                        </div>
                        <span class="text-xl font-bold text-gradient">GenZ Finance Hub</span>
                    </div>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="main_dashboard.html"
                        class="text-gray-600 hover:text-primary-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        <i class="fas fa-home mr-2"></i>Dashboard
                    </a>
                    <a href="money_mirror_analysis.html"
                        class="bg-primary-100 text-primary-700 px-3 py-2 rounded-md text-sm font-medium">
                        <i class="fas fa-mirror mr-2"></i>MoneyMirror
                    </a>
                    <a href="zero_budget_tracker.html"
                        class="text-gray-600 hover:text-primary-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        <i class="fas fa-piggy-bank mr-2"></i>ZeroBudget
                    </a>
                    <a href="subs_tracker_manager.html"
                        class="text-gray-600 hover:text-primary-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        <i class="fas fa-credit-card mr-2"></i>SubsTracker
                    </a>
                    <a href="investify_zero_game.html"
                        class="text-gray-600 hover:text-primary-600 px-3 py-2 rounded-md text-sm font-medium transition-colors">
                        <i class="fas fa-chart-line mr-2"></i>InvestifyZero
                    </a>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden">
                    <button id="mobileMenuBtn" class="text-gray-600 hover:text-primary-600 p-2">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>

                <!-- Profile -->
                <div class="hidden md:flex items-center">
                    <div class="relative">
                        <button
                            class="flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-primary-500">
                            <img src="https://images.unsplash.com/photo-1719735903589-2012c168d128"
                                alt="Profile picture" class="w-8 h-8 rounded-full"
                                onerror="this.src='https://images.unsplash.com/photo-1584824486509-112e4181ff6b?q=80&w=2940&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D'; this.onerror=null;">
                            <span class="ml-2 text-gray-700 font-medium" id="currentUserName">User Demo</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mobile Navigation Menu -->
        <div id="mobileMenu" class="md:hidden hidden bg-white/95 backdrop-blur-md border-t border-gray-200/50">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="main_dashboard.html"
                    class="text-gray-600 hover:text-primary-600 block px-3 py-2 rounded-md text-base font-medium">
                    <i class="fas fa-home mr-2"></i>Dashboard
                </a>
                <a href="money_mirror_analysis.html"
                    class="bg-primary-100 text-primary-700 block px-3 py-2 rounded-md text-base font-medium">
                    <i class="fas fa-mirror mr-2"></i>MoneyMirror
                </a>
                <a href="zero_budget_tracker.html"
                    class="text-gray-600 hover:text-primary-600 block px-3 py-2 rounded-md text-base font-medium">
                    <i class="fas fa-piggy-bank mr-2"></i>ZeroBudget
                </a>
                <a href="subs_tracker_manager.html"
                    class="text-gray-600 hover:text-primary-600 block px-3 py-2 rounded-md text-base font-medium">
                    <i class="fas fa-credit-card mr-2"></i>SubsTracker
                </a>
                <a href="investify_zero_game.html"
                    class="text-gray-600 hover:text-primary-600 block px-3 py-2 rounded-md text-base font-medium">
                    <i class="fas fa-chart-line mr-2"></i>InvestifyZero
                </a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="mb-8 fade-in">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gradient mb-2">MoneyMirror Analysis ü™û</h1>
                    <p class="text-text-secondary">Lacak mood harian dan analisis pola pengeluaran kamu</p>
                </div>
                <div class="hidden sm:flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-sm text-text-secondary">Total Pengeluaran Bulan Ini</p>
                        <p class="text-2xl font-bold text-primary-600" id="totalExpenseMonth">Rp 0</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Stats Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="morphic-card p-6 slide-up">
                <div class="flex items-center">
                    <div class="p-3 bg-primary-100 rounded-xl">
                        <i class="fas fa-smile text-primary-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-text-secondary">Mood Hari Ini</p>
                        <p class="text-xl font-bold text-primary-600" id="todayMood">üòä Senang</p>
                    </div>
                </div>
            </div>

            <div class="morphic-card p-6 slide-up" style="animation-delay: 100ms;">
                <div class="flex items-center">
                    <div class="p-3 bg-secondary-100 rounded-xl">
                        <i class="fas fa-wallet text-secondary-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-text-secondary">Pengeluaran Hari Ini</p>
                        <p class="text-xl font-bold text-secondary-600" id="todayExpense">Rp 0</p>
                    </div>
                </div>
            </div>

            <div class="morphic-card p-6 slide-up" style="animation-delay: 200ms;">
                <div class="flex items-center">
                    <div class="p-3 bg-accent-100 rounded-xl">
                        <i class="fas fa-chart-trending-up text-accent-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-text-secondary">Rata-rata Harian</p>
                        <p class="text-xl font-bold text-accent-600" id="averageExpense">Rp 0</p>
                    </div>
                </div>
            </div>

            <div class="morphic-card p-6 slide-up" style="animation-delay: 300ms;">
                <div class="flex items-center">
                    <div class="p-3 bg-success-100 rounded-xl">
                        <i class="fas fa-target text-success-600 text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm text-text-secondary">Streak Tracking</p>
                        <p class="text-xl font-bold text-success-600" id="trackingStreak">0 Hari</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mood & Expense Input Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Mood Tracker -->
            <div class="morphic-card p-6 fade-in">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-heart text-secondary-500 mr-2"></i>
                    Bagaimana mood kamu hari ini?
                </h2>

                <div class="grid grid-cols-5 gap-3 mb-6">
                    <button
                        class="mood-btn p-4 rounded-xl border-2 border-gray-200 hover:border-primary-300 transition-all duration-200 text-center micro-celebrate"
                        data-mood="1" data-label="Sangat Sedih">
                        <div class="text-3xl mb-2">üò¢</div>
                        <div class="text-xs text-gray-600">Sangat Sedih</div>
                    </button>
                    <button
                        class="mood-btn p-4 rounded-xl border-2 border-gray-200 hover:border-primary-300 transition-all duration-200 text-center micro-celebrate"
                        data-mood="2" data-label="Sedih">
                        <div class="text-3xl mb-2">üòî</div>
                        <div class="text-xs text-gray-600">Sedih</div>
                    </button>
                    <button
                        class="mood-btn p-4 rounded-xl border-2 border-gray-200 hover:border-primary-300 transition-all duration-200 text-center micro-celebrate"
                        data-mood="3" data-label="Biasa">
                        <div class="text-3xl mb-2">üòê</div>
                        <div class="text-xs text-gray-600">Biasa</div>
                    </button>
                    <button
                        class="mood-btn p-4 rounded-xl border-2 border-primary-300 bg-primary-50 transition-all duration-200 text-center selected"
                        data-mood="4" data-label="Senang">
                        <div class="text-3xl mb-2">üòä</div>
                        <div class="text-xs text-primary-600 font-medium">Senang</div>
                    </button>
                    <button
                        class="mood-btn p-4 rounded-xl border-2 border-gray-200 hover:border-primary-300 transition-all duration-200 text-center micro-celebrate"
                        data-mood="5" data-label="Sangat Senang">
                        <div class="text-3xl mb-2">üòÑ</div>
                        <div class="text-xs text-gray-600">Sangat Senang</div>
                    </button>
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Catatan Mood (Opsional)</label>
                    <textarea id="moodNotes" class="input-field w-full h-20 resize-none"
                        placeholder="Ceritakan tentang mood kamu hari ini..."></textarea>
                </div>

                <button id="saveMoodBtn" class="btn-primary w-full micro-celebrate">
                    <i class="fas fa-save mr-2"></i>
                    Simpan Mood Hari Ini
                </button>
            </div>

            <!-- Expense Input -->
            <div class="morphic-card p-6 fade-in">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-money-bill-wave text-accent-500 mr-2"></i>
                    Catat Pengeluaran
                </h2>

                <form id="expenseForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Jumlah Pengeluaran</label>
                        <div class="relative">
                            <span
                                class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500 font-medium">Rp</span>
                            <input type="text" id="expenseAmount" class="input-field w-full pl-10" placeholder="0"
                                required>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Kategori</label>
                        <select id="expenseCategory" class="input-field w-full" required>
                            <option value="">Pilih kategori</option>
                            <option value="makanan">üçî Makanan & Minuman</option>
                            <option value="transportasi">üöó Transportasi</option>
                            <option value="belanja">üõçÔ∏è Belanja</option>
                            <option value="hiburan">üé¨ Hiburan</option>
                            <option value="kesehatan">üíä Kesehatan</option>
                            <option value="pendidikan">üìö Pendidikan</option>
                            <option value="lainnya">üì¶ Lainnya</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Deskripsi</label>
                        <input type="text" id="expenseDescription" class="input-field w-full"
                            placeholder="Contoh: Makan siang di cafe">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Waktu</label>
                        <input type="datetime-local" id="expenseTime" class="input-field w-full" required>
                    </div>

                    <button type="submit" class="btn-secondary w-full micro-celebrate">
                        <i class="fas fa-plus mr-2"></i>
                        Tambah Pengeluaran
                    </button>
                </form>
            </div>
        </div>

        <!-- Chart Analysis Section -->
        <div class="morphic-card p-6 mb-8 fade-in">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">
                    <i class="fas fa-chart-line text-primary-500 mr-2"></i>
                    Analisis Mood vs Pengeluaran
                </h2>
                <div class="flex items-center space-x-4">
                    <select id="chartPeriod" class="input-field text-sm">
                        <option value="7">7 Hari Terakhir</option>
                        <option value="30" selected>30 Hari Terakhir</option>
                        <option value="90">3 Bulan Terakhir</option>
                    </select>
                    <button id="refreshChart" class="p-2 text-gray-500 hover:text-primary-600 transition-colors">
                        <i class="fas fa-refresh"></i>
                    </button>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="relative">
                <canvas id="moodExpenseChart" class="w-full h-80 rounded-lg"></canvas>
                <div id="chartLoading" class="absolute inset-0 flex items-center justify-center bg-white/80 rounded-lg">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-primary-500 mx-auto mb-2"></div>
                        <p class="text-sm text-gray-500">Memuat data chart...</p>
                    </div>
                </div>
            </div>

            <!-- Chart Legend -->
            <div class="flex items-center justify-center space-x-6 mt-4 text-sm">
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-primary-500 rounded-full mr-2"></div>
                    <span class="text-gray-600">Mood Score</span>
                </div>
                <div class="flex items-center">
                    <div class="w-3 h-3 bg-secondary-500 rounded-full mr-2"></div>
                    <span class="text-gray-600">Pengeluaran (Ribuan)</span>
                </div>
            </div>
        </div>

        <!-- Historical Data & Analysis -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Historical Data Table -->
            <div class="lg:col-span-2 morphic-card p-6 fade-in">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-800">
                        <i class="fas fa-history text-accent-500 mr-2"></i>
                        Riwayat Data
                    </h2>
                    <div class="flex items-center space-x-2">
                        <input type="date" id="filterDate" class="input-field text-sm">
                        <select id="filterMood" class="input-field text-sm">
                            <option value="">Semua Mood</option>
                            <option value="1">üò¢ Sangat Sedih</option>
                            <option value="2">üòî Sedih</option>
                            <option value="3">üòê Biasa</option>
                            <option value="4">üòä Senang</option>
                            <option value="5">üòÑ Sangat Senang</option>
                        </select>
                    </div>
                </div>

                <!-- Desktop Table -->
                <div class="hidden md:block overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="text-left py-3 px-2 text-sm font-medium text-gray-600">Tanggal</th>
                                <th class="text-left py-3 px-2 text-sm font-medium text-gray-600">Mood</th>
                                <th class="text-left py-3 px-2 text-sm font-medium text-gray-600">Pengeluaran</th>
                                <th class="text-left py-3 px-2 text-sm font-medium text-gray-600">Kategori</th>
                                <th class="text-left py-3 px-2 text-sm font-medium text-gray-600">Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="historyTableBody">
                            <!-- Data will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>

                <!-- Mobile Cards -->
                <div class="md:hidden space-y-4" id="historyMobileCards">
                    <!-- Cards will be populated by JavaScript -->
                </div>

                <!-- Pagination -->
                <div class="flex items-center justify-between mt-6">
                    <p class="text-sm text-gray-600">Menampilkan <span id="showingCount">0</span> dari <span
                            id="totalCount">0</span> data</p>
                    <div class="flex items-center space-x-2">
                        <button id="prevPage" class="p-2 text-gray-500 hover:text-primary-600 transition-colors">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="px-3 py-1 bg-primary-100 text-primary-600 rounded-md text-sm font-medium"
                            id="currentPageNumber">1</span>
                        <button id="nextPage" class="p-2 text-gray-500 hover:text-primary-600 transition-colors">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analysis Panel -->
            <div class="space-y-6">
                <!-- Insights Card -->
                <div class="morphic-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-lightbulb text-accent-500 mr-2"></i>
                        Insight Terbaru
                    </h3>

                    <div class="space-y-4" id="insightsContainer">
                        <!-- Insights will be populated dynamically -->
                    </div>
                </div>

                <!-- Progress Card -->
                <div class="morphic-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-chart-pie text-success-500 mr-2"></i>
                        Progress Tracking
                    </h3>

                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Konsistensi Tracking</span>
                                <span class="font-medium text-success-600" id="consistencyPercentage">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-success-500 h-2 rounded-full" id="consistencyBar" style="width: 0%">
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Mood Stability</span>
                                <span class="font-medium text-primary-600" id="moodStabilityPercentage">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-primary-500 h-2 rounded-full" id="moodStabilityBar" style="width: 0%">
                                </div>
                            </div>
                        </div>

                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600">Budget Control</span>
                                <span class="font-medium text-secondary-600" id="budgetControlPercentage">0%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-secondary-500 h-2 rounded-full" id="budgetControlBar" style="width: 0%">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 bg-gradient-to-r from-primary-50 to-secondary-50 rounded-lg">
                        <div class="text-center">
                            <div class="text-2xl font-bold text-gradient mb-1" id="userLevel">Level 1</div>
                            <div class="text-sm text-gray-600 mb-2" id="levelTitle">Money Mirror Beginner</div>
                            <div class="w-full bg-white rounded-full h-2">
                                <div class="bg-gradient-to-r from-primary-500 to-secondary-500 h-2 rounded-full"
                                    id="levelProgressBar" style="width: 0%"></div>
                            </div>
                            <div class="text-xs text-gray-500 mt-1" id="levelProgressText">0/100 XP to Level 2</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="morphic-card p-6 fade-in">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-bolt text-accent-500 mr-2"></i>
                        Quick Actions
                    </h3>

                    <div class="space-y-3">
                        <button id="exportDataBtn"
                            class="w-full p-3 text-left bg-gray-50 hover:bg-primary-50 rounded-lg transition-colors micro-celebrate">
                            <div class="flex items-center">
                                <i class="fas fa-download text-primary-500 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Export Data</p>
                                    <p class="text-xs text-gray-500">Download riwayat dalam format CSV</p>
                                </div>
                            </div>
                        </button>

                        <button id="shareProgressBtn"
                            class="w-full p-3 text-left bg-gray-50 hover:bg-secondary-50 rounded-lg transition-colors micro-celebrate">
                            <div class="flex items-center">
                                <i class="fas fa-share text-secondary-500 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Share Progress</p>
                                    <p class="text-xs text-gray-500">Bagikan pencapaian ke social media</p>
                                </div>
                            </div>
                        </button>

                        <button id="setReminderBtn"
                            class="w-full p-3 text-left bg-gray-50 hover:bg-accent-50 rounded-lg transition-colors micro-celebrate">
                            <div class="flex items-center">
                                <i class="fas fa-bell text-accent-500 mr-3"></i>
                                <div>
                                    <p class="text-sm font-medium text-gray-800">Set Reminder</p>
                                    <p class="text-xs text-gray-500">Pengingat harian untuk tracking</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="fixed top-4 right-4 z-50 hidden">
        <div id="successMessage" class="hidden p-4 bg-success-50 border border-success-200 rounded-lg shadow-lg">
            <div class="flex items-center">
                <i class="fas fa-check-circle text-success-500 mr-2"></i>
                <span class="text-success-700 text-sm font-medium" id="successText"></span>
            </div>
        </div>
        <div id="errorMessage" class="hidden p-4 bg-error-50 border border-error-200 rounded-lg shadow-lg">
            <div class="flex items-center">
                <i class="fas fa-exclamation-circle text-error-500 mr-2"></i>
                <span class="text-error-700 text-sm font-medium" id="errorText"></span>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        document.getElementById('mobileMenuBtn').addEventListener('click', function () {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        });

        // Global variables
        let currentMood = 4;
        let moodExpenseData = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let currentUserId = null;

        // User management functions
        function getCurrentUser() {
            const userSession = localStorage.getItem('userSession');
            if (userSession) {
                const session = JSON.parse(userSession);
                currentUserId = session.userId;
                document.getElementById('currentUserName').textContent = session.username || 'User Demo';
                return session;
            }
            return null;
        }

        function getUserDataKey() {
            return `moneyMirrorData_${currentUserId}`;
        }

        function getUserStatsKey() {
            return `userStats_${currentUserId}`;
        }

        function getDefaultUserStats() {
            return {
                totalExpenseMonth: 0,
                todayExpense: 0,
                averageExpense: 0,
                trackingStreak: 0,
                consistencyPercentage: 0,
                moodStabilityPercentage: 0,
                budgetControlPercentage: 0,
                userLevel: 1,
                levelTitle: "Money Mirror Beginner",
                currentXP: 0,
                nextLevelXP: 100
            };
        }

        function initializeUserData() {
            const userDataKey = getUserDataKey();
            const userStatsKey = getUserStatsKey();

            // Initialize user data if not exists
            if (!localStorage.getItem(userDataKey)) {
                localStorage.setItem(userDataKey, JSON.stringify([]));
            }

            // Initialize user stats if not exists
            if (!localStorage.getItem(userStatsKey)) {
                localStorage.setItem(userStatsKey, JSON.stringify(getDefaultUserStats()));
            }

            // Load user data
            moodExpenseData = JSON.parse(localStorage.getItem(userDataKey)) || [];

            // Update UI with user data
            updateStats();
            updateProgressBars();
            updateInsights();
        }

        function saveUserData() {
            const userDataKey = getUserDataKey();
            localStorage.setItem(userDataKey, JSON.stringify(moodExpenseData));
        }

        function updateUserStats(newStats) {
            const userStatsKey = getUserStatsKey();
            const currentStats = JSON.parse(localStorage.getItem(userStatsKey)) || getDefaultUserStats();
            const updatedStats = { ...currentStats, ...newStats };
            localStorage.setItem(userStatsKey, JSON.stringify(updatedStats));
            return updatedStats;
        }

        function calculateUserStats() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();

            // Filter data for current month
            const monthlyData = moodExpenseData.filter(entry => {
                const entryDate = new Date(entry.date);
                return entryDate.getMonth() === currentMonth && entryDate.getFullYear() === currentYear;
            });

            // Filter data for today
            const todayData = moodExpenseData.filter(entry => entry.date === today);

            // Calculate stats
            const totalExpenseMonth = monthlyData.reduce((sum, entry) => sum + entry.amount, 0);
            const todayExpense = todayData.reduce((sum, entry) => sum + entry.amount, 0);

            // Calculate average daily expense for current month
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const averageExpense = totalExpenseMonth / daysInMonth;

            // Calculate tracking streak (consecutive days with entries)
            let streak = 0;
            const sortedDates = [...new Set(moodExpenseData.map(entry => entry.date))].sort().reverse();
            let currentDate = new Date();

            for (let i = 0; i < sortedDates.length; i++) {
                const entryDate = new Date(sortedDates[i]);
                const diffTime = Math.abs(currentDate - entryDate);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                if (diffDays === i) {
                    streak++;
                } else {
                    break;
                }
            }

            // Calculate percentages based on data patterns
            const totalEntries = moodExpenseData.length;
            const daysTracked = new Set(moodExpenseData.map(entry => entry.date)).size;
            const consistencyPercentage = Math.min(100, Math.round((daysTracked / 30) * 100));

            // Mood stability calculation (simplified)
            const moodStabilityPercentage = totalEntries > 0 ? Math.min(100, Math.round((4 / 5) * 100)) : 0;

            // Budget control calculation (simplified)
            const budgetControlPercentage = totalEntries > 0 ? Math.min(100, Math.round((3 / 5) * 100)) : 0;

            // Calculate XP and level
            const baseXP = totalEntries * 10 + daysTracked * 5;
            const userLevel = Math.min(10, Math.floor(baseXP / 100) + 1);
            const currentXP = baseXP % 100;
            const nextLevelXP = 100;
            const levelTitles = [
                "Money Mirror Beginner", "Money Mirror Explorer", "Money Mirror Master",
                "Money Mirror Expert", "Money Mirror Guru", "Money Mirror Sage",
                "Money Mirror Legend", "Money Mirror Champion", "Money Mirror Hero",
                "Money Mirror Grand Master"
            ];
            const levelTitle = levelTitles[userLevel - 1] || "Money Mirror Master";

            return {
                totalExpenseMonth,
                todayExpense,
                averageExpense,
                trackingStreak: streak,
                consistencyPercentage,
                moodStabilityPercentage,
                budgetControlPercentage,
                userLevel,
                levelTitle,
                currentXP,
                nextLevelXP
            };
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function () {
            initializeApp();
            setupEventListeners();
            renderChart();
            renderHistoryTable();
            setCurrentDateTime();
            // Tambahkan di dalam function setupEventListeners() - cari bagian Quick Actions
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('shareProgressBtn').addEventListener('click', shareProgress);
            document.getElementById('setReminderBtn').addEventListener('click', setReminder);
            // Tambahkan di dalam function initializeApp()
            initializeReminders();
        });

        function initializeApp() {
            // Check if user is logged in
            const user = getCurrentUser();
            if (!user) {
                window.location.href = 'authentication_portal.html';
                return;
            }

            // Initialize user data
            initializeUserData();
        }

        function setupEventListeners() {
            // Mood selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.mood-btn').forEach(b => {
                        b.classList.remove('selected', 'border-primary-300', 'bg-primary-50');
                        b.classList.add('border-gray-200');
                        b.querySelector('.text-xs').classList.remove('text-primary-600', 'font-medium');
                        b.querySelector('.text-xs').classList.add('text-gray-600');
                    });

                    this.classList.add('selected', 'border-primary-300', 'bg-primary-50');
                    this.classList.remove('border-gray-200');
                    this.querySelector('.text-xs').classList.add('text-primary-600', 'font-medium');
                    this.querySelector('.text-xs').classList.remove('text-gray-600');

                    currentMood = parseInt(this.dataset.mood);
                });
            });

            // Save mood button
            document.getElementById('saveMoodBtn').addEventListener('click', function () {
                const notes = document.getElementById('moodNotes').value;
                const moodLabel = document.querySelector('.mood-btn.selected').dataset.label;

                // Save mood data
                const today = new Date().toISOString().split('T')[0];
                const existingEntry = moodExpenseData.find(entry => entry.date === today);

                if (existingEntry) {
                    existingEntry.mood = currentMood;
                    existingEntry.moodLabel = moodLabel;
                    existingEntry.moodNotes = notes;
                } else {
                    moodExpenseData.unshift({
                        date: today,
                        mood: currentMood,
                        moodLabel: moodLabel,
                        moodNotes: notes,
                        amount: 0,
                        category: '',
                        description: '',
                        time: ''
                    });
                }

                saveUserData();
                updateStats();
                showMessage('success', 'Mood berhasil disimpan! üéâ');
                renderChart();
                renderHistoryTable();
            });

            // Expense form
            document.getElementById('expenseForm').addEventListener('submit', function (e) {
                e.preventDefault();

                const amount = parseFloat(document.getElementById('expenseAmount').value.replace(/\./g, ''));
                const category = document.getElementById('expenseCategory').value;
                const description = document.getElementById('expenseDescription').value;
                const datetime = document.getElementById('expenseTime').value;

                if (!amount || !category || !datetime) {
                    showMessage('error', 'Mohon lengkapi semua field yang wajib diisi!');
                    return;
                }

                const date = datetime.split('T')[0];
                const time = datetime.split('T')[1];

                // Add expense data
                moodExpenseData.unshift({
                    date: date,
                    mood: currentMood,
                    moodLabel: document.querySelector('.mood-btn.selected').dataset.label,
                    amount: amount,
                    category: category,
                    description: description,
                    time: time
                });

                saveUserData();
                updateStats();

                // Reset form
                this.reset();
                setCurrentDateTime();

                showMessage('success', 'Pengeluaran berhasil ditambahkan! üí∞');
                renderChart();
                renderHistoryTable();
            });

            // Amount formatting
            document.getElementById('expenseAmount').addEventListener('input', function () {
                let value = this.value.replace(/\D/g, '');
                if (value) {
                    value = parseInt(value).toLocaleString('id-ID');
                }
                this.value = value;
            });

            // Chart period change
            document.getElementById('chartPeriod').addEventListener('change', function () {
                renderChart();
            });

            // Refresh chart
            document.getElementById('refreshChart').addEventListener('click', function () {
                renderChart();
            });

            // Filter events
            document.getElementById('filterDate').addEventListener('change', function () {
                renderHistoryTable();
            });

            document.getElementById('filterMood').addEventListener('change', function () {
                renderHistoryTable();
            });

            // Quick actions
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('shareProgressBtn').addEventListener('click', shareProgress);
            document.getElementById('setReminderBtn').addEventListener('click', setReminder);
        }

        function setCurrentDateTime() {
            const now = new Date();
            const datetime = now.toISOString().slice(0, 16);
            document.getElementById('expenseTime').value = datetime;
        }

        function showMessage(type, message) {
            const messageContainer = document.getElementById('messageContainer');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const successText = document.getElementById('successText');
            const errorText = document.getElementById('errorText');

            messageContainer.classList.remove('hidden');

            if (type === 'success') {
                successMessage.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                successText.textContent = message;
            } else {
                errorMessage.classList.remove('hidden');
                successMessage.classList.add('hidden');
                errorText.textContent = message;
            }

            setTimeout(() => {
                messageContainer.classList.add('hidden');
                successMessage.classList.add('hidden');
                errorMessage.classList.add('hidden');
            }, 5000);
        }

        function updateStats() {
            const stats = calculateUserStats();
            updateUserStats(stats);

            // Update UI
            document.getElementById('totalExpenseMonth').textContent = `Rp ${stats.totalExpenseMonth.toLocaleString('id-ID')}`;
            document.getElementById('todayExpense').textContent = `Rp ${stats.todayExpense.toLocaleString('id-ID')}`;
            document.getElementById('averageExpense').textContent = `Rp ${Math.round(stats.averageExpense).toLocaleString('id-ID')}`;
            document.getElementById('trackingStreak').textContent = `${stats.trackingStreak} Hari`;

            // Update today's mood
            const today = new Date().toISOString().split('T')[0];
            const todayEntry = moodExpenseData.find(entry => entry.date === today);
            if (todayEntry) {
                document.getElementById('todayMood').textContent = `${getMoodEmoji(todayEntry.mood)} ${todayEntry.moodLabel}`;
            }
        }

        function updateProgressBars() {
            const stats = calculateUserStats();

            document.getElementById('consistencyPercentage').textContent = `${stats.consistencyPercentage}%`;
            document.getElementById('moodStabilityPercentage').textContent = `${stats.moodStabilityPercentage}%`;
            document.getElementById('budgetControlPercentage').textContent = `${stats.budgetControlPercentage}%`;

            document.getElementById('consistencyBar').style.width = `${stats.consistencyPercentage}%`;
            document.getElementById('moodStabilityBar').style.width = `${stats.moodStabilityPercentage}%`;
            document.getElementById('budgetControlBar').style.width = `${stats.budgetControlPercentage}%`;

            document.getElementById('userLevel').textContent = `Level ${stats.userLevel}`;
            document.getElementById('levelTitle').textContent = stats.levelTitle;
            document.getElementById('levelProgressBar').style.width = `${(stats.currentXP / stats.nextLevelXP) * 100}%`;
            document.getElementById('levelProgressText').textContent = `${stats.currentXP}/${stats.nextLevelXP} XP to Level ${stats.userLevel + 1}`;
        }

        function updateInsights() {
            const insightsContainer = document.getElementById('insightsContainer');
            const stats = calculateUserStats();

            let insights = [];

            if (moodExpenseData.length === 0) {
                insights.push({
                    type: 'primary',
                    icon: 'fas fa-rocket',
                    title: 'Selamat Datang!',
                    message: 'Mulai track mood dan pengeluaran kamu untuk mendapatkan insight yang berguna.'
                });
            } else {
                if (stats.trackingStreak >= 7) {
                    insights.push({
                        type: 'success',
                        icon: 'fas fa-fire',
                        title: 'Streak Impresif!',
                        message: `Kamu telah konsisten tracking selama ${stats.trackingStreak} hari berturut-turut. Pertahankan!`
                    });
                }

                if (stats.averageExpense > 100000) {
                    insights.push({
                        type: 'secondary',
                        icon: 'fas fa-lightbulb',
                        title: 'Tips Penghematan',
                        message: 'Coba alokasikan 30% dari pengeluaran untuk tabungan dan investasi.'
                    });
                }

                // Default insight
                insights.push({
                    type: 'accent',
                    icon: 'fas fa-chart-line',
                    title: 'Progress Bagus!',
                    message: 'Terus lanjutkan tracking untuk melihat pola pengeluaran dan mood kamu.'
                });
            }

            // Ensure we always have at least one insight
            if (insights.length === 0) {
                insights.push({
                    type: 'primary',
                    icon: 'fas fa-smile',
                    title: 'Keep Going!',
                    message: 'Setiap data yang kamu catat membantu memahami kebiasaan finansial lebih baik.'
                });
            }

            insightsContainer.innerHTML = insights.map(insight => `
                <div class="p-4 bg-${insight.type}-50 rounded-lg border-l-4 border-${insight.type}-500">
                    <div class="flex items-start">
                        <i class="${insight.icon} text-${insight.type}-500 mt-1 mr-3"></i>
                        <div>
                            <p class="text-sm font-medium text-${insight.type}-700">${insight.title}</p>
                            <p class="text-xs text-${insight.type}-600 mt-1">${insight.message}</p>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderChart() {
            const canvas = document.getElementById('moodExpenseChart');
            const ctx = canvas.getContext('2d');
            const period = parseInt(document.getElementById('chartPeriod').value);

            // Show loading
            document.getElementById('chartLoading').classList.remove('hidden');

            setTimeout(() => {
                // Filter data by period
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - period);

                const filteredData = moodExpenseData.filter(entry => {
                    const entryDate = new Date(entry.date);
                    return entryDate >= startDate && entryDate <= endDate && entry.amount > 0;
                }).slice(0, period);

                // Clear canvas
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (filteredData.length === 0) {
                    ctx.fillStyle = '#6B7280';
                    ctx.font = '16px Inter';
                    ctx.textAlign = 'center';
                    ctx.fillText('Belum ada data untuk ditampilkan', canvas.width / 2, canvas.height / 2);
                    document.getElementById('chartLoading').classList.add('hidden');
                    return;
                }

                // Set canvas size
                const rect = canvas.getBoundingClientRect();
                canvas.width = rect.width * window.devicePixelRatio;
                canvas.height = rect.height * window.devicePixelRatio;
                ctx.scale(window.devicePixelRatio, window.devicePixelRatio);

                const width = rect.width;
                const height = rect.height;
                const padding = 60;
                const chartWidth = width - padding * 2;
                const chartHeight = height - padding * 2;

                // Find min/max values
                const maxAmount = Math.max(...filteredData.map(d => d.amount));
                const minAmount = Math.min(...filteredData.map(d => d.amount));
                const maxMood = 5;
                const minMood = 1;

                // Draw grid
                ctx.strokeStyle = '#E5E7EB';
                ctx.lineWidth = 1;

                // Vertical grid lines
                for (let i = 0; i <= 10; i++) {
                    const x = padding + (chartWidth / 10) * i;
                    ctx.beginPath();
                    ctx.moveTo(x, padding);
                    ctx.lineTo(x, height - padding);
                    ctx.stroke();
                }

                // Horizontal grid lines
                for (let i = 0; i <= 5; i++) {
                    const y = padding + (chartHeight / 5) * i;
                    ctx.beginPath();
                    ctx.moveTo(padding, y);
                    ctx.lineTo(width - padding, y);
                    ctx.stroke();
                }

                // Draw axes
                ctx.strokeStyle = '#374151';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.moveTo(padding, padding);
                ctx.lineTo(padding, height - padding);
                ctx.lineTo(width - padding, height - padding);
                ctx.stroke();

                // Draw data points
                filteredData.forEach((entry, index) => {
                    const x = padding + (chartWidth / (filteredData.length - 1)) * index;
                    const moodY = height - padding - ((entry.mood - minMood) / (maxMood - minMood)) * chartHeight;
                    const amountY = height - padding - ((entry.amount - minAmount) / (maxAmount - minAmount)) * chartHeight;

                    // Mood point
                    ctx.fillStyle = '#6366F1';
                    ctx.beginPath();
                    ctx.arc(x, moodY, 6, 0, 2 * Math.PI);
                    ctx.fill();

                    // Amount point
                    ctx.fillStyle = '#EC4899';
                    ctx.beginPath();
                    ctx.arc(x, amountY, 6, 0, 2 * Math.PI);
                    ctx.fill();

                    // Connect mood points
                    if (index > 0) {
                        const prevX = padding + (chartWidth / (filteredData.length - 1)) * (index - 1);
                        const prevMoodY = height - padding - ((filteredData[index - 1].mood - minMood) / (maxMood - minMood)) * chartHeight;
                        const prevAmountY = height - padding - ((filteredData[index - 1].amount - minAmount) / (maxAmount - minAmount)) * chartHeight;

                        // Mood line
                        ctx.strokeStyle = '#6366F1';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(prevX, prevMoodY);
                        ctx.lineTo(x, moodY);
                        ctx.stroke();

                        // Amount line
                        ctx.strokeStyle = '#EC4899';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(prevX, prevAmountY);
                        ctx.lineTo(x, amountY);
                        ctx.stroke();
                    }
                });

                // Draw labels
                ctx.fillStyle = '#6B7280';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';

                // Y-axis labels (left - mood)
                ctx.textAlign = 'right';
                for (let i = 1; i <= 5; i++) {
                    const y = height - padding - ((i - minMood) / (maxMood - minMood)) * chartHeight;
                    ctx.fillText(i.toString(), padding - 10, y + 4);
                }

                // Y-axis labels (right - amount)
                ctx.textAlign = 'left';
                for (let i = 0; i <= 5; i++) {
                    const amount = minAmount + ((maxAmount - minAmount) / 5) * i;
                    const y = height - padding - (i / 5) * chartHeight;
                    ctx.fillText((amount / 1000).toFixed(0) + 'k', width - padding + 10, y + 4);
                }

                document.getElementById('chartLoading').classList.add('hidden');
            }, 1000);
        }

        function renderHistoryTable() {
            const filterDate = document.getElementById('filterDate').value;
            const filterMood = document.getElementById('filterMood').value;

            let filteredData = moodExpenseData.filter(entry => entry.amount > 0);

            if (filterDate) {
                filteredData = filteredData.filter(entry => entry.date === filterDate);
            }

            if (filterMood) {
                filteredData = filteredData.filter(entry => entry.mood == filterMood);
            }

            // Desktop table
            const tableBody = document.getElementById('historyTableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageData = filteredData.slice(startIndex, endIndex);

            tableBody.innerHTML = '';
            pageData.forEach((entry, index) => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50 transition-colors';
                row.innerHTML = `
                    <td class="py-3 px-2 text-sm text-gray-800">${formatDate(entry.date)}</td>
                    <td class="py-3 px-2 text-sm">${getMoodEmoji(entry.mood)} ${entry.moodLabel}</td>
                    <td class="py-3 px-2 text-sm font-medium text-gray-800">Rp ${entry.amount.toLocaleString('id-ID')}</td>
                    <td class="py-3 px-2 text-sm text-gray-600">${getCategoryIcon(entry.category)} ${getCategoryName(entry.category)}</td>
                    <td class="py-3 px-2 text-sm">
                        <button class="text-primary-600 hover:text-primary-700 mr-2" onclick="editEntry(${startIndex + index})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-error-600 hover:text-error-700" onclick="deleteEntry(${startIndex + index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            // Mobile cards
            const mobileCards = document.getElementById('historyMobileCards');
            mobileCards.innerHTML = '';
            pageData.forEach((entry, index) => {
                const card = document.createElement('div');
                card.className = 'morphic-card p-4';
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div class="flex items-center">
                            <span class="text-lg mr-2">${getMoodEmoji(entry.mood)}</span>
                            <div>
                                <p class="font-medium text-gray-800">Rp ${entry.amount.toLocaleString('id-ID')}</p>
                                <p class="text-sm text-gray-600">${formatDate(entry.date)} ‚Ä¢ ${entry.time}</p>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="text-primary-600 hover:text-primary-700" onclick="editEntry(${startIndex + index})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-error-600 hover:text-error-700" onclick="deleteEntry(${startIndex + index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm text-gray-600">${getCategoryIcon(entry.category)} ${getCategoryName(entry.category)}</span>
                        <span class="text-sm text-gray-500">${entry.moodLabel}</span>
                    </div>
                    ${entry.description ? `<p class="text-sm text-gray-600 mt-2">${entry.description}</p>` : ''}
                `;
                mobileCards.appendChild(card);
            });

            // Update pagination
            document.getElementById('showingCount').textContent = pageData.length;
            document.getElementById('totalCount').textContent = filteredData.length;
            document.getElementById('currentPageNumber').textContent = currentPage;
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('id-ID', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        function getMoodEmoji(mood) {
            const emojis = ['', 'üò¢', 'üòî', 'üòê', 'üòä', 'üòÑ'];
            return emojis[mood] || 'üòê';
        }

        function getCategoryIcon(category) {
            const icons = {
                'makanan': 'üçî',
                'transportasi': 'üöó',
                'belanja': 'üõçÔ∏è',
                'hiburan': 'üé¨',
                'kesehatan': 'üíä',
                'pendidikan': 'üìö',
                'lainnya': 'üì¶'
            };
            return icons[category] || 'üì¶';
        }

        function getCategoryName(category) {
            const names = {
                'makanan': 'Makanan & Minuman',
                'transportasi': 'Transportasi',
                'belanja': 'Belanja',
                'hiburan': 'Hiburan',
                'kesehatan': 'Kesehatan',
                'pendidikan': 'Pendidikan',
                'lainnya': 'Lainnya'
            };
            return names[category] || 'Lainnya';
        }

        function editEntry(index) {
            // This would open an edit modal
            showMessage('success', 'Fitur edit akan segera hadir! üöÄ');
        }

        function deleteEntry(index) {
            if (confirm('Yakin ingin menghapus data ini?')) {
                moodExpenseData.splice(index, 1);
                saveUserData();
                updateStats();
                updateProgressBars();
                updateInsights();
                renderHistoryTable();
                renderChart();
                showMessage('success', 'Data berhasil dihapus! üóëÔ∏è');
            }
        }

        function exportData() {
            showMessage('success', 'Fitur export data akan segera hadir! üìä');
        }

        function shareProgress() {
            showMessage('success', 'Fitur share progress akan segera hadir! üì±');
        }

        function setReminder() {
            showMessage('success', 'Fitur reminder akan segera hadir! ‚è∞');
        }

        // Pagination
        document.getElementById('prevPage').addEventListener('click', function () {
            if (currentPage > 1) {
                currentPage--;
                renderHistoryTable();
            }
        });

        document.getElementById('nextPage').addEventListener('click', function () {
            const totalPages = Math.ceil(moodExpenseData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderHistoryTable();
            }
        });

        // Export Data Function
        function exportData() {
            if (moodExpenseData.length === 0) {
                showMessage('error', 'Belum ada data untuk di-export!');
                return;
            }

            // Create CSV content
            let csvContent = "Tanggal,Mood,Pengeluaran,Kategori,Deskripsi,Waktu\\n";

            moodExpenseData.forEach(entry => {
                const row = [
                    entry.date,
                    entry.moodLabel,
                    entry.amount,
                    getCategoryName(entry.category),
                    entry.description || '',
                    entry.time || ''
                ];
                csvContent += row.join(',') + '\\n';
            });

            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);

            link.setAttribute('href', url);
            link.setAttribute('download', `money-mirror-data-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showMessage('success', 'Data berhasil di-export! üìä');
        }

        // Set Reminder Function
        function setReminder() {
            // Check if browser supports notifications
            if (!("Notification" in window)) {
                showMessage('error', 'Browser tidak mendukung notifikasi!');
                return;
            }

            // Request permission
            Notification.requestPermission().then(permission => {
                if (permission === "granted") {
                    // Create reminder in localStorage
                    const reminder = {
                        id: Date.now(),
                        enabled: true,
                        time: "20:00",
                        message: "Jangan lupa catat mood dan pengeluaran hari ini! üìù",
                        createdAt: new Date().toISOString()
                    };

                    const userStatsKey = getUserStatsKey();
                    const currentStats = JSON.parse(localStorage.getItem(userStatsKey)) || getDefaultUserStats();
                    currentStats.reminder = reminder;
                    localStorage.setItem(userStatsKey, JSON.stringify(currentStats));

                    // Show confirmation notification
                    if (Notification.permission === "granted") {
                        new Notification("Reminder Disetel! ‚è∞", {
                            body: "Kami akan mengingatkan kamu setiap jam 20:00 untuk tracking harian",
                            icon: "/favicon.ico"
                        });
                    }

                    showMessage('success', 'Reminder berhasil disetel! ‚è∞\\nKami akan mengingatkan jam 20:00 setiap hari.');
                } else {
                    showMessage('error', 'Izin notifikasi ditolak. Aktifkan notifikasi untuk reminder.');
                }
            });
        }

        // Share Progress Function
        function shareProgress() {
            const stats = calculateUserStats();

            // Create shareable content
            const shareContent = {
                title: "Progress MoneyMirror Saya üìä",
                text: `Saya sudah tracking mood dan pengeluaran selama ${stats.trackingStreak} hari berturut-turut! üéØ\\n\\n` +
                    `Total Pengeluaran Bulan Ini: Rp ${stats.totalExpenseMonth.toLocaleString('id-ID')}\\n` +
                    `Level: ${stats.userLevel} - ${stats.levelTitle}\\n\\n` +
                    `Download GenZ Finance Hub untuk mulai tracking keuanganmu! üí∞`,
                url: window.location.origin
            };

            // Check if Web Share API is available
            if (navigator.share) {
                navigator.share(shareContent)
                    .then(() => showMessage('success', 'Progress berhasil dibagikan! üéâ'))
                    .catch(error => {
                        console.log('Error sharing:', error);
                        fallbackShare(shareContent);
                    });
            } else {
                fallbackShare(shareContent);
            }
        }

        // Fallback share for browsers without Web Share API
        function fallbackShare(shareContent) {
            // Copy to clipboard as fallback
            const textToCopy = `${shareContent.title}\\n\\n${shareContent.text}`;

            navigator.clipboard.writeText(textToCopy).then(() => {
                showMessage('success', 'Progress berhasil disalin ke clipboard! üìã\\nSekarang bisa paste di media sosial.');
            }).catch(() => {
                // Final fallback - show modal with shareable text
                showShareModal(shareContent);
            });
        }

        // Show share modal for manual sharing
        function showShareModal(shareContent) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 fade-in';
            modal.innerHTML = `
        <div class="bg-white rounded-2xl p-6 w-full max-w-md morphic-card bounce-in">
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-xl font-bold text-gray-900">Bagikan Progress</h3>
                <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600 transition-all duration-300 hover:scale-110">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <div class="mb-4 p-4 bg-gray-50 rounded-lg">
                <p class="text-sm text-gray-600 mb-2">Salin teks di bawah untuk dibagikan:</p>
                <textarea class="w-full h-32 p-3 text-sm border border-gray-300 rounded-lg resize-none" readonly>${shareContent.text}</textarea>
            </div>
            
            <div class="flex space-x-3">
                <button onclick="copyShareText()" class="flex-1 py-3 bg-primary-500 hover:bg-primary-600 text-white rounded-lg font-medium transition-all duration-300 hover:scale-105 micro-celebrate">
                    <i class="fas fa-copy mr-2"></i>
                    Salin Teks
                </button>
                <button onclick="this.closest('.fixed').remove()" class="flex-1 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-medium transition-all duration-300 hover:scale-105">
                    Tutup
                </button>
            </div>
        </div>
    `;

            document.body.appendChild(modal);
        }

        // Copy share text to clipboard
        function copyShareText() {
            const textarea = document.querySelector('.fixed textarea');
            textarea.select();
            document.execCommand('copy');

            showMessage('success', 'Teks berhasil disalin ke clipboard! üìã');
            document.querySelector('.fixed').remove();
        }

        // Check and trigger daily reminders
        function checkDailyReminder() {
            const userStatsKey = getUserStatsKey();
            const currentStats = JSON.parse(localStorage.getItem(userStatsKey)) || getDefaultUserStats();

            if (currentStats.reminder && currentStats.reminder.enabled) {
                const now = new Date();
                const currentTime = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');

                // Check if it's reminder time and user hasn't tracked today
                if (currentTime === currentStats.reminder.time) {
                    const today = new Date().toISOString().split('T')[0];
                    const hasTrackedToday = moodExpenseData.some(entry => entry.date === today);

                    if (!hasTrackedToday && Notification.permission === "granted") {
                        new Notification("MoneyMirror Reminder ‚è∞", {
                            body: currentStats.reminder.message,
                            icon: "/favicon.ico",
                            tag: "daily-reminder"
                        });
                    }
                }
            }
        }

        // Initialize reminder check
        function initializeReminders() {
            // Check reminder every minute
            setInterval(checkDailyReminder, 60000);

            // Initial check
            checkDailyReminder();
        }

        // =========================================
        // FORM RESPONSIF JAVASCRIPT
        // =========================================

        // Function untuk mengatur form responsif
        function initResponsiveForm() {
            if (window.innerWidth <= 768) {
                setupMobileForm();
                setupCurrencyInput();
                setupFormValidation();
            }
        }

        // Setup form untuk mobile
        function setupMobileForm() {
            const form = document.getElementById('expenseForm');
            const inputs = form.querySelectorAll('.input-field');

            inputs.forEach(input => {
                // Tambahkan class untuk mobile
                input.classList.add('mobile-input');

                // Setup untuk input datetime-local
                if (input.type === 'datetime-local') {
                    setupDateTimeInput(input);
                }

                // Setup untuk currency input
                if (input.id === 'expenseAmount') {
                    setupCurrencyInputBehavior(input);
                }

                // Setup untuk select
                if (input.tagName === 'SELECT') {
                    setupSelectInput(input);
                }

                // Setup untuk textarea
                if (input.tagName === 'TEXTAREA') {
                    setupTextareaInput(input);
                }
            });

            // Adjust form spacing
            adjustFormSpacing();

            // Handle form submission untuk mobile
            setupMobileFormSubmit();
        }

        // Setup currency input behavior
        function setupCurrencyInputBehavior(input) {
            // Format currency on input
            input.addEventListener('input', function (e) {
                let value = this.value.replace(/[^\d]/g, '');

                if (value) {
                    // Format dengan titik sebagai pemisah ribuan
                    value = parseInt(value, 10).toLocaleString('id-ID');
                    this.value = value;
                }
            });

            // Pastikan cursor berada di akhir
            input.addEventListener('focus', function () {
                setTimeout(() => {
                    this.setSelectionRange(this.value.length, this.value.length);
                }, 0);
            });

            // Validasi on blur
            input.addEventListener('blur', function () {
                let value = this.value.replace(/[^\d]/g, '');
                if (!value || parseInt(value) <= 0) {
                    this.style.borderColor = '#ef4444';
                } else {
                    this.style.borderColor = '#10b981';
                }
            });
        }

        // Setup datetime input untuk mobile
        function setupDateTimeInput(input) {
            // Set min date to today
            const today = new Date().toISOString().slice(0, 16);
            input.min = today;

            // Add clear button untuk mobile
            const wrapper = input.parentElement;
            if (!wrapper.querySelector('.clear-datetime-btn')) {
                const clearBtn = document.createElement('button');
                clearBtn.type = 'button';
                clearBtn.className = 'clear-datetime-btn';
                clearBtn.innerHTML = '<i class="fas fa-times"></i>';
                clearBtn.style.cssText = `
                position: absolute;
                right: 10px;
                top: 50%;
                transform: translateY(-50%);
                background: transparent;
                border: none;
                color: #9ca3af;
                font-size: 14px;
                cursor: pointer;
                display: none;
            `;

                wrapper.style.position = 'relative';
                wrapper.appendChild(clearBtn);

                // Show clear button when there's value
                input.addEventListener('input', function () {
                    clearBtn.style.display = this.value ? 'block' : 'none';
                });

                // Clear on click
                clearBtn.addEventListener('click', function () {
                    input.value = '';
                    this.style.display = 'none';
                });
            }
        }

        // Setup select input untuk mobile
        function setupSelectInput(select) {
            // Add custom arrow untuk konsistensi
            select.style.backgroundImage = "url(\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\")";
            select.style.backgroundRepeat = "no-repeat";
            select.style.backgroundPosition = "right 12px center";
            select.style.backgroundSize = "16px";
            select.style.paddingRight = "36px";

            // Add change feedback
            select.addEventListener('change', function () {
                if (this.value) {
                    this.style.borderColor = '#10b981';
                }
            });
        }

        // Setup textarea input
        function setupTextareaInput(textarea) {
            // Auto resize
            textarea.style.resize = 'vertical';
            textarea.style.minHeight = '100px';
            textarea.style.maxHeight = '300px';

            // Character counter untuk mobile
            const counter = document.createElement('div');
            counter.className = 'char-counter';
            counter.style.cssText = `
            font-size: 12px;
            color: #9ca3af;
            text-align: right;
            margin-top: 4px;
            display: none;
        `;

            textarea.parentElement.appendChild(counter);

            // Update counter
            textarea.addEventListener('input', function () {
                const count = this.value.length;
                counter.textContent = `${count} karakter`;
                counter.style.display = count > 0 ? 'block' : 'none';

                // Change color based on length
                if (count > 200) {
                    counter.style.color = '#f59e0b';
                } else if (count > 400) {
                    counter.style.color = '#ef4444';
                } else {
                    counter.style.color = '#9ca3af';
                }
            });
        }

        // Adjust form spacing untuk mobile
        function adjustFormSpacing() {
            const formGroups = document.querySelectorAll('#expenseForm > div');
            formGroups.forEach((group, index) => {
                // Add bottom margin
                group.style.marginBottom = '1.25rem';

                // Add animation delay untuk visual feedback
                group.style.animationDelay = `${index * 50}ms`;
            });
        }

        // Setup mobile form submission
        function setupMobileFormSubmit() {
            const form = document.getElementById('expenseForm');
            const submitBtn = form.querySelector('button[type="submit"]');

            // Add loading state
            submitBtn.addEventListener('click', function (e) {
                if (form.checkValidity()) {
                    // Show loading
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Menyimpan...';
                    this.disabled = true;

                    // Reset setelah 2 detik (simulasi)
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.disabled = false;
                    }, 2000);
                }
            });

            // Handle keyboard submit
            form.addEventListener('keydown', function (e) {
                if (e.key === 'Enter' && !e.target.matches('textarea')) {
                    e.preventDefault();
                    submitBtn.click();
                }
            });
        }

        // Setup form validation
        function setupFormValidation() {
            const form = document.getElementById('expenseForm');
            const inputs = form.querySelectorAll('[required]');

            inputs.forEach(input => {
                // Real-time validation
                input.addEventListener('blur', function () {
                    validateField(this);
                });

                // Instant feedback
                input.addEventListener('input', function () {
                    if (this.value.trim()) {
                        this.style.borderColor = '#10b981';
                    }
                });
            });

            // Submit validation
            form.addEventListener('submit', function (e) {
                let isValid = true;

                inputs.forEach(input => {
                    if (!validateField(input)) {
                        isValid = false;
                    }
                });

                if (!isValid) {
                    e.preventDefault();
                    showFormError('Mohon periksa kembali data yang diisi');
                }
            });
        }

        // Validate individual field
        function validateField(field) {
            const value = field.value.trim();
            const isValid = field.checkValidity();

            if (!isValid || !value) {
                field.style.borderColor = '#ef4444';

                // Show error message
                let errorMsg = field.parentElement.querySelector('.field-error');
                if (!errorMsg) {
                    errorMsg = document.createElement('div');
                    errorMsg.className = 'field-error';
                    errorMsg.style.cssText = `
                    color: #ef4444;
                    font-size: 12px;
                    margin-top: 4px;
                `;
                    field.parentElement.appendChild(errorMsg);
                }

                if (field.type === 'datetime-local' && !value) {
                    errorMsg.textContent = 'Waktu harus diisi';
                } else if (field.id === 'expenseAmount' && (!value || parseInt(value.replace(/[^\d]/g, '')) <= 0)) {
                    errorMsg.textContent = 'Jumlah harus lebih dari 0';
                } else if (field.type === 'select-one' && !value) {
                    errorMsg.textContent = 'Pilih salah satu kategori';
                } else {
                    errorMsg.textContent = field.validationMessage || 'Field ini wajib diisi';
                }

                return false;
            } else {
                field.style.borderColor = '#10b981';

                // Remove error message
                const errorMsg = field.parentElement.querySelector('.field-error');
                if (errorMsg) {
                    errorMsg.remove();
                }

                return true;
            }
        }

        // Show form error
        function showFormError(message) {
            // Create error container
            let errorContainer = document.getElementById('formErrorContainer');
            if (!errorContainer) {
                errorContainer = document.createElement('div');
                errorContainer.id = 'formErrorContainer';
                errorContainer.style.cssText = `
                background: #fee2e2;
                border: 1px solid #fecaca;
                color: #dc2626;
                padding: 12px;
                border-radius: 8px;
                margin-bottom: 16px;
                font-size: 14px;
                display: flex;
                align-items: center;
                gap: 8px;
            `;

                const form = document.getElementById('expenseForm');
                form.insertBefore(errorContainer, form.firstChild);
            }

            errorContainer.innerHTML = `
            <i class="fas fa-exclamation-circle"></i>
            <span>${message}</span>
        `;

            // Auto hide setelah 5 detik
            setTimeout(() => {
                errorContainer.remove();
            }, 5000);
        }

        // Initialize ketika DOM siap
        document.addEventListener('DOMContentLoaded', function () {
            initResponsiveForm();

            // Re-initialize on resize
            window.addEventListener('resize', function () {
                initResponsiveForm();
            });

            // Re-initialize on orientation change
            window.addEventListener('orientationchange', function () {
                setTimeout(initResponsiveForm, 100);
            });
        });

        // Handle virtual keyboard events
        document.addEventListener('focusin', function (e) {
            if (e.target.matches('.input-field') && window.innerWidth <= 768) {
                // Scroll ke input
                setTimeout(() => {
                    e.target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }, 300);
            }
        });
    </script>
    <script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>

</html>
